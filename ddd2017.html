
<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8"> 
  <title>Tufts: Getting Started With DDD</title>
  <link rel = "stylesheet" type = "text/css" href = "course.css">
  <style type="text/css">
  body {max-width: 50em;}
  table {
    border-collapse: collapse;
  }

  table, th {
  border: 2px solid black;
  }
  td {
  border: 1px solid black;
  }

  table   { width: 100%;}
  th.topic { width: 15%;}
  th.command { width: 25%;}
  </style>
</head>

<body class="homework">



<!-- Common course navigation menu bar  -->

<div id = "menubar">
<p>
  <a class='menu_item' href='../.'>Home</a>  <a class='menu_item' href='../cal'>Calendar</a>  <a class='menu_item' href='../reference/index'>Reference</a>  <a class='menu_item' href='../admin'>Admin</a>  <a class='menu_item' href='https://piazza.com/tufts/spring2017/comp40/home'>Piazza</a></p>
</div>
<div id = "topmatter">
<!--
  <div id = "logo" onclick = "document.location = './index.html'"></div>
-->
  <div id = "topcontent">
    <h1>Comp 40 Lab 7:<br>DDD and Intel Assembly</h1>
  </div>
</div>


<div id = "maincontent" class = "plain_text">

  <div id='itsnew' style="border:solid; border-width:1px; padding:0.5em; color:blue;">
    <p> This lab is new for Spring 2017. </p>
  </div>

<h2 id="purpose">Purpose of this lab</h2>

<p>Today's lab is supposed to give you familiarity with DDD, the tool most Comp40 students use to defuse the binary bomb. It's really good to understand how the tool works before you start working on the bomb, and today's lab should also help make some concepts surrounding Intel assembly. So if possible, please work on this lab on your own, but obviously fell free to talk</p>

<p>Some things to note:</p>

<ul>
  <li>DDD is famously fragile and you can easily get into trouble using it even in ways that seem reasonable. Indeed,
  when the binary bomb assignment comes out, you must follow the specific rules we publish at http://www.
  cs.tufts.edu/comp/40/homework/ddd-rules or you will be responsible for grade reductions resulting
  from DDD bugs. If you do follow the rules and DDD still “explodes” your bomb, gather documentation and let
  us know immediately...we will make reasonable accomodations. In any case, read the rules now, as they may be
  helpful for this lab too.</li>
  <li>DDD is just a graphical tool for using GDB. If you're familiar with using GDB and find DDD annoying, feel free to use GDB but be warned that in general, the TAs are more familiar with DDD than they are GDB</li>
</ul>

<h2 id="gettingit">Getting the lab materials</h2>

To get the code for today's lab, run the following:
<pre style="margin-left:1cm">
git clone https://github.com/charliemeyer/comp40DDDlabS2017.git
cd comp40DDDlabS2017
</pre>
<i>TODO: The code for this lab should be hosted on the course servers.</i>

<h2 id="DDDtips">Getting Started</h2>
First, run <pre>make all</pre> which should produce 2 executables:
<code>loop</code> and <code>linkedlist</code>.

<h3>Playing with loops: breakpoints, <code>step</code>, and <code>next</code></h3>

To open DDD and work with the loop code, run <code>ddd loop</code>.
<br><br>
If one shows up, close the tip of the day, and now let's get familiar with what DDD has to offer. 

While you're working on the bomb, you'll likely want to be able to see C code, machine code, and the data view, so make sure both of those windows are all open within your DDD session. (You can toggle which views are open with the "View" menu in the top bar). You can resize your different windows using the little boxes on the right hand side of the screen.

<br><br>

Next, let's set a <i>breakpoint</i>, which is one of the key things you can do in DDD, or any debugger. Do this by double clicking to the left of the source line where you want your program to pause. When you run your code (which we'll do soon), DDD will stop your program's execution at the first breakpoint it hits. Set a breakpoint on the line with the <code>for</code>. Notice that a stop sign shows up in the machine code window as well!

<br><br>

Now, let's run the code. In the <code>Program</code> menu, click <code>Run</code> and a dialog box should pop up. In the box labeled <code>Run with arguments</code>, enter some space delimitted strings, which we know will get passed to your program in <code>argv</code>. 

<p style='color: red; font-weight: bold;'>WARNING! One of the most frustrating things about DDD is that your cursor needs to be over a textbox while you type into it. Sorry.</p>

<p>Hit "Run" at the bottom of the textbox, and you should see a green arrow appear at each of the breakpoints (represented by stop signs) in the machine code. We can now use the <code>next</code> and <code>step</code> buttons to progress the code slowly.</p>

<p><code>step</code> steps through your code a line at a time, and will enter into any function calls. So, click step a few times just to see what happens. Keep clicking, and note that we are no longer in familiar territory, we're going way down into printf. Keep clicking. Observe how the green arrow in the machine code window moves along with the one in the C window. What does this mean? Note that you can also click <code>stepi</code> to move the green arrow one machine instruction at a time. This will certainly come in handy in the bomb. If you make it out of the call to printf and your green arrow gets back to your breakpoint, try to use <code>stepi</code> until you're right at the instruction which calls printf. </p>


<p>If clicking through printf seemed like it was a pain, you're not alone! Thankfully, <code>next</code> steps through your code a C source line at a time, but importantly it <i>skips</i> through function calls. Give it a try! It should be much faster to go one iteration through the loop in loop.c when you're using <code>next</code>.</p>


<p>Now that we're good at <code>step</code>ing and <code>next</code>ing through the code, let's try and better understand the connection between the C code and the machine code we see. In the "Status" menu, you can click "Registers" to have a handy window showing the contents of all the registers appear as you're stepping through the code.

Before moving to the next question, answer the following questions (check answers with the TAs before moving on):

<ul>
  <li>What machine instructions correspond to the for loop's <code>i < argc</code> test?</li>
  <li>What machine instruction increments <code>i</code>?.</li>
  <li>What is in <code>%eax</code> following each call to <code>printf</code>? What does this value mean?</li>
</ul> 


Note that nothing bad will happen if you mess up using DDD today. If you mess up, just re-run the program, and even if you never mess up, try running it with different numbers of command line arguments just to see what happens.

<h3>Playing with lists: the <code>display</code> tool</h3>

<p>When you're done with the exercises above, open up the <code>linkedlist</code> program.

<p>Using the skills you gained in the last section, set up a breakpoint after the list is initialized and run the code.</p> 

The goal of this section is to get comfortable using the <code>Display</code> window to view variables and data structures. In the big text box at the top of the DDD window, type a C expression. If you're lucky, you'll be able to type an expression like <code>xs</code> into the box and

<p style='color: red; font-weight: bold;'>HIT THE LITTLE DISPLAY FLASHLIGHT BUTTON DO NOT HIT ENTER</p>

Now you can double click the pointer in that first linked list node and keep doing that until the whole list is displayed in the window. 

<p>When you don't have the C code available to you, you can still display data, but using expressions involving registers. 

<p style='color: red; font-weight: bold;'>TO DISPLAY A REGISTER YOU TYPE $eax NOT %eax</p>

Try displaying the list again, this time using the register containing the pointer to the head of the list.


Now, complete the following tasks:

<ul>
  <li>Write a function called <code>increment_list</code> which takes in a list and adds one to each of its elements</li>
  <li>When you're confident that code works, run list in DDD, setting a breakpoint before your call to increment list. Get the list displayed in the display window, and step through your <code>increment_list</code> function. Watch as the values increase before your eyes!</li>
</ul>

<img src="ddd.png" alt="dunkin donuts" style='width:500px'/>

<h1><i>"America Runs on DDD"</i></h1>


</div>


<div id = "dogtag">
Mark Sheldon, Charlie Meyer, Carter Casey<br>
   Last Modified 9 Mar 2017
</div> <!-- dogtag -->

</body>
</html>
